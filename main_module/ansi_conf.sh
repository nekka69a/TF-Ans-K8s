#!/bin/bash
#The first line creates the private ssh key in the agent working directory. For some reason, the single terraform output command didn't give an usable key name
#The second line actually creates the inventory.ini used by Ansible
sudo echo -e "[masters]\n\nmaster ansible_host=$(sudo terraform output -raw Ctlplane_Pub_Ip) ansible_user=azureuser\nmaster ansible_ssh_private_key_file=$(terraform output -raw private_keyctl > id_rsa_ctl)\n\n[workers]\n\nworker0 ansible_host=$(sudo terraform output -raw Worker1_Pub_Ip) ansible_user=azureuser\nworker0 ansible_ssh_private_key_file=$(terraform output -raw private_keyctl > id_rsa_ctl)\n\nworker1 ansible_host=$(sudo terraform output -raw Worker2_Pub_Ip) ansible_user=azureuser\nworker1 ansible_ssh_private_key_file=$(terraform output -raw private_keyctl > id_rsa_ctl)" > inventory.ini 
sudo echo -e "[masters]\n\nmaster ansible_host=$(sudo terraform output -raw Ctlplane_Pub_Ip) ansible_user=$(terraform output -raw vm_usernames)\nmaster ansible_ssh_private_key_file=$PWD/id_rsa_ctl\n\n[workers]\n\nworker0 ansible_host=$(sudo terraform output -raw Worker1_Pub_Ip) ansible_user=$(terraform output -raw vm_usernames)\nworker0 ansible_ssh_private_key_file=$PWD/id_rsa_ctl\n\nworker1 ansible_host=$(sudo terraform output -raw Worker2_Pub_Ip) ansible_user=$(terraform output -raw vm_usernames)\nworker1 ansible_ssh_private_key_file=$PWD/id_rsa_ctl" > inventory.ini
